# Revenj Example - Package Shipping Management
This example was bootstrapped with [Create React App](https://github.com/facebook/create-react-app).

It is linked to the revenj package in the parent directory for development purposes.

## Behaviour

This is a simple example application which showcases use of [DSL](https://dsl-platform.com/) in conjunction with the Revenj library.
It includes a basic setup of an application, definition of several views in the DSL language, and an example on how to connect all of it into a working whole.

The application is a basic package shipping management system, where users can, depending on their permissions, search packages, enter new packages into the system, view and edit their details, as well as change package status to In Deliver, Delievered, or Returned to Sender.

Only packages which are in a Pending state can be edited by the user.

The system mocks the user authorization, instead of really requiring user login and authorization.

A small backend is built in Node and uses an in-memory collection of users instead of storing it to some database. The application is hand-built, rather than using some of the DSL targets.

## Building and Running

As a pre-condition, you must build the `revenj` library locally. You can do this by running `yarn build` in its root folder. A local library build, referenced with `link` in [`package.json`](./package.json), is used directly.

The example application is meant to be run by doing two things in parallel, both from the `example` folder:

1. Run `yarn start` - this will build TypeScript code from DSL, and then run the application in watch mode
2. Run `yarn api` - this will build a minimal subset of TypeScript (just the models) and run the Express from the `api` folder, using `ts-node`

The application will be available on [localhost:3000](http://localhost:3000)

## Caveats

The application was built with certain non-standard CRA modifications. Firstly, to use `revenj` with DSL, we need to enable use of namespaces. Since babel transpilation does not support it by default, we used [react-app-rewired](https://www.npmjs.com/package/react-app-rewired) and [customize-cra](https://www.npmjs.com/package/customize-cra) to modify the default configuration. To do the same, you need to add a `config-overrides.js` file in the root of your project with the following contents:

```js
const { override, addBabelPlugin } = require('customize-cra');

// DSL-generated code leverages namespaces to create "rich enums", therefore we need to enable this flag
module.exports = override(
  addBabelPlugin([
      "@babel/plugin-transform-typescript",
      { allowNamespaces: true }
  ])
);
```

Secondly, as noted, we modify the build and watch steps in `package.json` to include a pre-step of building DSL code into TypeScript/React, as follows:

```json
"scripts": {
  "start": "yarn build:dsl && react-app-rewired start",
  "build:dsl": "java -jar scripts/dsl-clc.jar dsl=./dsl react=./src/dsl download",
  "build:ts": "react-app-rewired build",
  "build": "yarn build:dsl && yarn build:ts",
```

Thirdly, as an optional step, we can leverage the class names generated by the compiler. Currently, the compiler-generated code from DSL contains several class names specific to [Bootstrap](https://getbootstrap.com/) and [Font Awesome](https://fontawesome.com/), in particular for actions, buttons, and input element wrappers. While you can avoid usage of these, you can choose to include the Bootstrap and Font Awesome CSS files into your project for a default (if not especially unique) appearance.

We do so from CDNs by including them into our `public/index.html` file as follows:

```html
<link
  rel="stylesheet"
  href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
  integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
  crossorigin="anonymous"
/>
<link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
/>
```
